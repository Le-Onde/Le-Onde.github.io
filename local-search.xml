<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Redis学习笔记9 Redis持久化之AOF</title>
    <link href="/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-Redis%E6%8C%81%E4%B9%85%E5%8C%96%E4%B9%8BAOF/"/>
    <url>/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-Redis%E6%8C%81%E4%B9%85%E5%8C%96%E4%B9%8BAOF/</url>
    
    <content type="html"><![CDATA[<h3 id="一、AOF概念"><a href="#一、AOF概念" class="headerlink" title="一、AOF概念"></a>一、AOF概念</h3><ul><li>AOF(append only file)持久化：以独立日志的方式记录每次写命令，重启时再重新执行AOF文件中命令，达到恢复数据的目的。与RDB相比可以简单描述为<strong>改记录数据为记录数据产生的过程</strong></li><li>AOF的主要作用时解决了数据持久化的实时性，目前已经是Redis持久化的主流方式</li></ul><h3 id="二、AOF写数据过程"><a href="#二、AOF写数据过程" class="headerlink" title="二、AOF写数据过程"></a>二、AOF写数据过程</h3><p><img src="https://img-blog.csdnimg.cn/20210422194954247.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="三、AOF写数据三种策略（appendfsync）"><a href="#三、AOF写数据三种策略（appendfsync）" class="headerlink" title="三、AOF写数据三种策略（appendfsync）"></a>三、AOF写数据三种策略（appendfsync）</h3><ul><li><p>always（每次）</p><p>每次写入操作均同步到AOF文件中，<strong>数据零误差，性能较低</strong></p></li><li><p>everysec（每秒）</p><p>每次将缓冲区中的指令同步到AOF文件中，<strong>数据准确性较高，性能较高</strong>，在系统突然宕机的情况下丢失1秒内的数据（建议使用，也是默认配置）</p></li><li><p>no（系统控制）</p><p>由操作系统控制每次同步到AOF文件的周期，整体过程<strong>不可控</strong></p><p>​</p></li></ul><h3 id="四、AOF功能开启"><a href="#四、AOF功能开启" class="headerlink" title="四、AOF功能开启"></a>四、AOF功能开启</h3><ul><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">appendonly yes|no<br></code></pre></td></tr></table></figure><ul><li><p>作用</p><p>是否开启AOF持久化功能，默认为不开启状态</p></li></ul></li><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">appendfsync always|everysec|no<br></code></pre></td></tr></table></figure><ul><li><p>作用</p><p>AOF写数据策略</p></li></ul></li><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">appendfilename filename<br></code></pre></td></tr></table></figure><ul><li><p>作用</p><p>AOF持久化文件名，默认文件名为appendonly.aof，建议配置为appendonly-端口号.aof</p></li></ul></li><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dir<br></code></pre></td></tr></table></figure><ul><li><p>作用</p><p>AOF持久化文件保存路径，与RDB持久化文件保持一致即可</p></li></ul></li></ul><h3 id="五、AOF写数据遇到的问题"><a href="#五、AOF写数据遇到的问题" class="headerlink" title="五、AOF写数据遇到的问题"></a>五、AOF写数据遇到的问题</h3><p><strong>如果连续执行如下指令该如何处理</strong></p><p><img src="https://img-blog.csdnimg.cn/2021042220280729.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><p>AOF重写</p><h3 id="六、AOF重写"><a href="#六、AOF重写" class="headerlink" title="六、AOF重写"></a>六、AOF重写</h3><p>随着命令不断写入AOF，文件会越来越大，为了解决这个问题，Redis引入AOF重写机制压缩文件体积。AOF文件重写是将Redis进程内的数据转化为写命令同步到新AOF文件的过程。简单说就是<strong>将对同一个数据的若干条命令执行结果转化成最终结果数据对应的指令进行记录。</strong></p><h4 id="AOF重写作用"><a href="#AOF重写作用" class="headerlink" title="AOF重写作用"></a>AOF重写作用</h4><ul><li>降低磁盘占用量，提高磁盘利用率</li><li>提高持久化效率，降低持久化写时间，提高IO性能</li><li>降低数据恢复用时，提高数据恢复效率</li></ul><h4 id="AOF重写规则"><a href="#AOF重写规则" class="headerlink" title="AOF重写规则"></a>AOF重写规则</h4><ul><li><p>进程内已超时的数据不再写入文件</p></li><li><p>忽略无效指令，重写时使用进程内数据直接生成，这样新的AOF文件只保留最终数据的写入命令，如del key1、hdel key2、srem key3、set key4 123、set key4 222等</p></li><li><p>对同一数据的多条写命令合并为一条命令，如lpush list1 a、lpush list1 b、lpush list1 c 可以转化为：lpush list1 a b c。</p><p>为防止数据量过大造成客户端缓冲区溢出，对list、set、hash、zset等类型、每条指令最多写入64个元素</p></li></ul><h4 id="AOF重写方式（手动重写）"><a href="#AOF重写方式（手动重写）" class="headerlink" title="AOF重写方式（手动重写）"></a>AOF重写方式（手动重写）</h4><ul><li><p>手动重写</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bgrewriteaof<br></code></pre></td></tr></table></figure></li><li><p>自动重写</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">auto-aof-rewrite-min-size size<br>auto-aof-rewrite-percentage percentage<br></code></pre></td></tr></table></figure></li></ul><h4 id="AOF手动重写——bgrewriteaof指令工作原理"><a href="#AOF手动重写——bgrewriteaof指令工作原理" class="headerlink" title="AOF手动重写——bgrewriteaof指令工作原理"></a>AOF手动重写——bgrewriteaof指令工作原理</h4><p><img src="https://img-blog.csdnimg.cn/20210422204256378.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h4 id="AOF重写方式（自动重写）"><a href="#AOF重写方式（自动重写）" class="headerlink" title="AOF重写方式（自动重写）"></a>AOF重写方式（自动重写）</h4><ul><li><p>自动重写触发条件格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">auto-aof-rewrite-min-size size<br>auto-aof-rewrite-percentage percent<br></code></pre></td></tr></table></figure></li><li><p>自动重写触发对比参数（运行指令info Persistence获取具体信息）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">aof_current_size<br>aof_base_size<br></code></pre></td></tr></table></figure></li><li><p>自动重写触发条件</p><p><img src="https://img-blog.csdnimg.cn/20210422205637212.png" alt="img"></p><h4 id="AOF工作流程"><a href="#AOF工作流程" class="headerlink" title="AOF工作流程"></a>AOF工作流程</h4><p><img src="https://img-blog.csdnimg.cn/20210422210052662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h4 id="AOF重写流程"><a href="#AOF重写流程" class="headerlink" title="AOF重写流程"></a>AOF重写流程</h4><p><img src="https://img-blog.csdnimg.cn/20210422210223933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li></ul><p><img src="https://img-blog.csdnimg.cn/20210422210336449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><ul><li>AOF缓冲区同步文件策略，由参数appendfsync控制</li></ul><p><strong>系统调用write和fsync说明：</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422210709540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="七、RDB与AOF区别"><a href="#七、RDB与AOF区别" class="headerlink" title="七、RDB与AOF区别"></a>七、RDB与AOF区别</h3><p><img src="https://img-blog.csdnimg.cn/20210422210809864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>RDB与AOF选择之惑</strong></p><ul><li>对数据非常敏感，建议使用默认的AOF持久化方案<ul><li>AOF持久化策略使用erverysecond，每秒钟fsync一次。该策略redis任然可以保持很好的处理性能，当出现问题时，最多丢失0-1秒中的数据。</li><li>注意：由于AOF文件存储体积较大，且恢复数据较慢</li></ul></li><li>数据呈现阶段有效性，建议使用RDB持久化方案<ul><li>数据可以良好的做到阶段内无丢失（该阶段是开发者或运维人工手工维护的），且恢复速度较快，阶段点数据恢复通常采用RDB方案</li><li>注意：利用RDB实现紧凑的数据持久化会使Redis降得很低</li></ul></li><li>综合对比<ol><li>RDB与AOF得选择实际上是在做一种权衡，每种都有利弊</li><li>如不能承受数分钟以内得数据丢失，对业务数据非常敏感，选用AOF</li><li>如能承受数分钟以内数据丢失，且追求大数据集得恢复速度，选用RDB</li><li>灾难恢复选用RDB</li><li>双保险策略，同时开启RDB和AOF，重启后，Redis优先使用AOF来恢复数据，降低丢失数据的量</li></ol></li></ul><p><strong>持久化应用场景</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422211202670.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记8 Redis持久化之RDB</title>
    <link href="/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-Redis%E6%8C%81%E4%B9%85%E5%8C%96%E4%B9%8BRDB/"/>
    <url>/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-Redis%E6%8C%81%E4%B9%85%E5%8C%96%E4%B9%8BRDB/</url>
    
    <content type="html"><![CDATA[<h2 id="一、持久化简介"><a href="#一、持久化简介" class="headerlink" title="一、持久化简介"></a>一、持久化简介</h2><h3 id="1-什么是持久化"><a href="#1-什么是持久化" class="headerlink" title="1.什么是持久化"></a>1.什么是持久化</h3><p>利用永久性存储介质将数据进行保存，在特定的时间将保存的数据进行恢复的工作机制称为持久化。</p><h3 id="2-为什么要进行持久化"><a href="#2-为什么要进行持久化" class="headerlink" title="2.为什么要进行持久化"></a>2.为什么要进行持久化</h3><p>防止数据的意外丢失，确保数据安全性</p><h3 id="3-持久化过程保存什么"><a href="#3-持久化过程保存什么" class="headerlink" title="3.持久化过程保存什么"></a>3.持久化过程保存什么</h3><ul><li><p>将当前数据状态进行保存，快照形式，存储数据结果，存储格式简单，关注点在数据。</p></li><li><p>将数据的操作过程进行保存，日志形式，存储操作过程，存储格式复杂，关注点在数据的操作过程。</p><p><img src="https://img-blog.csdnimg.cn/2021042215521812.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p>​</p></li></ul><h2 id="二、RDB"><a href="#二、RDB" class="headerlink" title="二、RDB"></a>二、RDB</h2><h3 id="1-RDB启动方式（手动执行）"><a href="#1-RDB启动方式（手动执行）" class="headerlink" title="1.RDB启动方式（手动执行）"></a>1.RDB启动方式（手动执行）</h3><p><strong>命令执行</strong></p><ul><li>谁：redis操作者（用户）</li><li>什么时间：即使（随时进行）</li><li>干什么事情：保存数据</li></ul><p><strong>RDB启动方式——save指令</strong></p><ul><li><p>命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">save<br></code></pre></td></tr></table></figure></li><li><p>作用</p><p>手动执行一次保存操作</p></li></ul><p><strong>RDB启动方式——save指令相关配置</strong></p><ul><li><p>dbfilename dump.rdb</p><p>说明 : 设置本地数据库文件名，默认值为dump.rdb</p><p>经验 : 通常设置为<strong>dump-端口号.rdb</strong></p></li><li><p>dir</p><p>说明 : 设置存储.rdb文件路径</p><p>经验 : 通常设置成存储空间较大的目录 , 目录名称为data</p></li><li><p>rdbcompression yes</p><p>说明 : 设置存储至本地数据库时是否压缩数据 , 默认为yes , 采用LZF压缩</p><p>经验 : 通常默认为开启状态 , 如果设置为no , 可以节省CPU运行时间 , 但会使存储的文件变大(巨大)</p></li><li><p>rdbchecksum yes</p><p>说明 : 设置是否进行RDB文件格式校验 , 该校验过程在写文件个读文件过程均进行</p><p>经验 : 通常默认为开启状态 , 如果设置为no , 可以节约读写性过程约10%时间消耗 , 但是存储一定的数据损坏风险</p></li></ul><p><strong>RDB启动方式——save指令工作原理</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422160844486.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><em>注意：</em> <strong>Redis是单线程的</strong>，所有命令都会在类似队列中排好队，不建议使用save指令，因为save指令的执行会阻塞当前Redis服务器，直到当前RDB过程完成位置，有可能会造成长时间阻塞，<strong>线上环境不建议使用</strong></p><h3 id="2-RDB启动方式（后台执行）"><a href="#2-RDB启动方式（后台执行）" class="headerlink" title="2.RDB启动方式（后台执行）"></a>2.RDB启动方式（后台执行）</h3><p><strong>后台执行</strong></p><ul><li>谁：redis操作者（用户）发起指令；redis服务器控制指令执行</li><li>什么时间：即使（发起）；合理时间（执行）</li><li>干什么事情：保存数据</li></ul><p><strong>RDB启动方式——bgsave</strong></p><ul><li><p>命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bgsave<br></code></pre></td></tr></table></figure></li><li><p>作用</p><p>手动启动后台保存操作，但不是立即执行</p></li></ul><p><strong>RDB启动方式——bgsave指令工作原理</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422161702164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><em>注意：</em>bgsave命令是针对save阻塞问题做的优化。Redis内部所有涉及到RDB操作都采用bgsave的方式，save命令可以放弃使用</p><p><strong>RDB启动方式——bgsave指令相关配置</strong></p><ul><li><p>stop-writes-on-bgsave-error yes</p><p>说明：后台存储过程中如果出现错误现象，是否停止保存操作</p><p>经验：默认为开启</p></li></ul><h3 id="3-RDB启动方式（自动执行）"><a href="#3-RDB启动方式（自动执行）" class="headerlink" title="3.RDB启动方式（自动执行）"></a>3.RDB启动方式（自动执行）</h3><p><strong>自动执行</strong></p><ul><li>谁：redis服务器发起指令（基于条件）</li><li>什么时间：满足条件</li><li>干什么事情：保存数据</li></ul><p><strong>RDB启动方式——save配置</strong></p><ul><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">save second changes<br></code></pre></td></tr></table></figure></li><li><p>满足限定时间范围内key的变化数量达到指定数量即进行持久化</p></li><li><p>参数</p><p>second：监控时间范围</p><p>changes：监控key的变化量</p></li><li><p>位置</p><p>conf文件中配置</p></li><li><p>范例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">save 900 1<br>save 300 10<br>save 60 10000<br></code></pre></td></tr></table></figure></li></ul><p><strong>RDB启动方式——save配置原理</strong></p><p><img src="https://img-blog.csdnimg.cn/2021042216312487.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><em>注意：</em> </p><ul><li>save配置要根据实际业务情况进行设置，频度过高或过低都会出现性能问题，结果可能是灾难性的</li><li>save配置中对second与changes设置通常具有互补对应关系，尽量不要设置成包含性关系</li><li>save配置启动后执行的是bgsave操作</li></ul><p><strong>RDB三种启动方式对比</strong></p><ul><li>save配置启动后由于执行的还是bgsave操作所以不在进行对比。</li></ul><p><img src="https://img-blog.csdnimg.cn/20210422163458239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>RDB特殊启动方式</strong></p><ul><li><p>全量复制</p><p>在主从复制中详细介绍</p></li><li><p>服务器运行过程中重启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">debug reload<br></code></pre></td></tr></table></figure></li><li><p>关闭服务器时指定保存数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">shutdown<br></code></pre></td></tr></table></figure><ul><li>默认情况下执行shutdown命令时，自动执行bgsave（如果没有开启AOF持久化功能）</li></ul></li></ul><h3 id="RDB优点"><a href="#RDB优点" class="headerlink" title="RDB优点"></a>RDB优点</h3><ul><li>RDB是一个紧凑压缩的二进制文件，存储效率较高</li><li>RDB内部存储的是redis在某个<strong>时间点</strong>的数据快照，非常适合用于数据备份，全量复制等场景</li><li>RDB恢复数据的速度要比AOF快很多</li><li>应用：服务器中每x小时执行bgsave备份，并将RDB文件拷贝到远程机器中，用于灾难恢复</li></ul><h3 id="RDB缺点"><a href="#RDB缺点" class="headerlink" title="RDB缺点"></a>RDB缺点</h3><ul><li>RDB方式无论是执行指令还是利用配置，无法做到实时持久化，具有较大的可能性丢失数据</li><li>bgsave指令每次运行要执行fork操作创建子进程，要牺牲掉一些性能</li><li>redis的众多版本中未进行RDB文件格式的版本统一，有可能出现各版本服务器之间数据格式无法兼容现象</li></ul><h3 id="RDB存储的弊端"><a href="#RDB存储的弊端" class="headerlink" title="RDB存储的弊端"></a>RDB存储的弊端</h3><ul><li>存储数据量大，效率较低<ul><li>基于快照思想，每次读写都是全部数据，当数据量巨大时，效率非常低</li></ul></li><li>大数据量下的IO性能较低</li><li>基于fork创建子进程，内存产生额外消耗</li><li>宕机带来的数据丢失风险</li></ul><p><strong>解决思路</strong></p><ul><li>不写全数据，仅记录部分数据</li><li>降低区分数据是否改变的难度，改记录数据为记录操作过程</li><li>对所有操作均进行记录，排除丢失数据的风险</li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记7 Jedis连接并操作Redis</title>
    <link href="/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-Jedis%E8%BF%9E%E6%8E%A5%E5%B9%B6%E6%93%8D%E4%BD%9CRedis/"/>
    <url>/2021/04/22/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-Jedis%E8%BF%9E%E6%8E%A5%E5%B9%B6%E6%93%8D%E4%BD%9CRedis/</url>
    
    <content type="html"><![CDATA[<h3 id="一、Jedis简介"><a href="#一、Jedis简介" class="headerlink" title="一、Jedis简介"></a>一、Jedis简介</h3><p><strong>编程语言与redis</strong></p><ul><li><p>Java语言连接redis服务</p><p>Jedis</p><p>SpringData Redis</p><p>Lettuce</p><p>​</p></li></ul><h3 id="二、Jedis操作Redis"><a href="#二、Jedis操作Redis" class="headerlink" title="二、Jedis操作Redis"></a>二、Jedis操作Redis</h3><p><strong>准备工作</strong></p><ul><li><p>基于maven导入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>连接redis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">6379</span>)<br></code></pre></td></tr></table></figure></li><li><p>操作redis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">jedis.set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;itheima&quot;</span>);<br>jedis.get(<span class="hljs-string">&quot;name&quot;</span>);<br></code></pre></td></tr></table></figure></li><li><p>关闭redis连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">jedis.close();<br></code></pre></td></tr></table></figure></li><li><p>API文档</p><p><a href="https://xetorthio.github.io/jedis/">https://xetorthio.github.io/jedis/</a></p></li></ul><h4 id="Jedis简易工具类开发"><a href="#Jedis简易工具类开发" class="headerlink" title="Jedis简易工具类开发"></a>Jedis简易工具类开发</h4><p><strong>基于连接池获取数据</strong></p><ul><li><p>JedisPool：Jedis提供的连接池技术</p><p>​    poolConfig：连接池配置对象</p><p>​    host：redis服务地址</p><p>​    port：redis服务端口号</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JedisPool</span> <span class="hljs-params">(GenericObjectPoolConfig poolConfig, String host, <span class="hljs-keyword">int</span> port)</span></span>&#123;<br>  <span class="hljs-keyword">this</span>(poolConfig, host, port, <span class="hljs-number">2000</span>, (String)<span class="hljs-keyword">null</span>, <span class="hljs-number">0</span>, (String)<span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>封装连接参数</strong></p><ul><li><p>jedis.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">jedis.host</span>=<span class="hljs-string">localhost</span><br><span class="hljs-meta">jedis.prot</span>=<span class="hljs-string">6379</span><br><span class="hljs-meta">jedis.maxTotal</span>=<span class="hljs-string">30</span><br><span class="hljs-meta">jedis.maxIdle</span>=<span class="hljs-string">10</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>加载配置信息</strong></p><ul><li><p>静态代码块初始化资源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JedisUtils</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JedisPool jp;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String host;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> port;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> maxTotal;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> maxIdle;<br>    <span class="hljs-keyword">static</span> &#123;<br>        JedisPoolConfig jpc=<span class="hljs-keyword">new</span> JedisPoolConfig();<br>        ResourceBundle rb=ResourceBundle.getBundle(<span class="hljs-string">&quot;redis&quot;</span>);<br>        host=rb.getString(<span class="hljs-string">&quot;redis.host&quot;</span>);<br>        port=Integer.parseInt(rb.getString(<span class="hljs-string">&quot;redis.port&quot;</span>));<br>        maxTotal=Integer.parseInt(rb.getString(<span class="hljs-string">&quot;redis.maxTotal&quot;</span>));<br>        maxIdle=Integer.parseInt(rb.getString(<span class="hljs-string">&quot;redis.maxIdle&quot;</span>));<br>        jpc.setMaxTotal(maxTotal);<br>        jpc.setMaxIdle(maxIdle);<br>        jp=<span class="hljs-keyword">new</span> JedisPool(jpc,host,port);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure></li><li><p>对外访问外接口，提供jedis连接对象，连接从连接池获取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title">getJedis</span><span class="hljs-params">()</span></span>&#123;<br>      <span class="hljs-keyword">return</span> jp.getResource();<br>  &#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="三、Jedis读写redis数据"><a href="#三、Jedis读写redis数据" class="headerlink" title="三、Jedis读写redis数据"></a>三、Jedis读写redis数据</h3><p><strong>案例实现</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422101849577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>需求分析</strong></p><p><img src="https://img-blog.csdnimg.cn/20210422101957835.png" alt="img"></p><p><strong>实现步骤</strong></p><ul><li><p>1.设定业务方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">business</span><span class="hljs-params">(String id, <span class="hljs-keyword">long</span> num)</span></span>&#123;<br>  System.out.println(<span class="hljs-string">&quot;用户&quot;</span>+id+<span class="hljs-string">&quot;业务发起调用&quot;</span>,<span class="hljs-string">&quot;当前第&quot;</span>+num+<span class="hljs-string">&quot;次&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>2.设定多线类，模拟用户调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>&#123;<br>  <span class="hljs-keyword">while</span>(ture)&#123;<br>    jd.service(id);<br>    <span class="hljs-comment">//模拟调用间隔，设定为1.x秒</span><br>    <span class="hljs-keyword">try</span>&#123;<br>      Random r = <span class="hljs-keyword">new</span> Random();<br>      Thread.sleep(<span class="hljs-number">1000</span>+r.nextInt(<span class="hljs-number">200</span>));<br>    &#125;<span class="hljs-keyword">catch</span>(InterruptedException e)&#123;<br>      e.printStackTrace();<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>3.设计redis控制方案</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(String id)</span></span>&#123;<br>  Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">6379</span>);<br>  String value = jedis.get(<span class="hljs-string">&quot;compid:&quot;</span>+id);<br>  <span class="hljs-comment">//判定是否具有调用计数控制，利用异常进行控制处理</span><br>  <span class="hljs-keyword">if</span>(value==<span class="hljs-keyword">null</span>)&#123;<br>    jedis.setex(<span class="hljs-string">&quot;compid:&quot;</span>+id,<span class="hljs-number">20</span>,<span class="hljs-string">&quot;&quot;</span>+(Long.MAX_VALUE-<span class="hljs-number">10</span>));<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//有控制，自增，并调用业务</span><br>    <span class="hljs-keyword">try</span>&#123;<br>      Long val = redis.incr(<span class="hljs-string">&quot;compid:&quot;</span>+id);<br>      business(id,<span class="hljs-number">10</span>+val-Long.MAX_VALUE);<br>    &#125;<span class="hljs-keyword">catch</span>(JedisDataExpection e)&#123;<br>      System.out.println(<span class="hljs-string">&quot;用户&quot;</span>+id+<span class="hljs-string">&quot;使用次数到达上线&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>      jedis.close();<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>设计启动主程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[],args)</span></span>&#123;<br>  MyThread t1 = <span class="hljs-keyword">new</span> MyThread(<span class="hljs-string">&quot;初级用户&quot;</span>);<br>  t1.start();<br>&#125;<br></code></pre></td></tr></table></figure><p>​</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记6 key和数据库通用指令</title>
    <link href="/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-key%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%9A%E7%94%A8%E6%8C%87%E4%BB%A4/"/>
    <url>/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-key%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%9A%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="一、key通用操作"><a href="#一、key通用操作" class="headerlink" title="一、key通用操作"></a>一、key通用操作</h2><h3 id="1-key特征"><a href="#1-key特征" class="headerlink" title="1.key特征"></a>1.key特征</h3><ul><li>key是一个字符串，通过key获取redis中保存的数据</li></ul><h3 id="2-key设计的操作"><a href="#2-key设计的操作" class="headerlink" title="2.key设计的操作"></a>2.key设计的操作</h3><ul><li>对于key自身状态的相关操作，例如：删除，判定存在，获取类型等</li><li>对于key有效性控制相关操作，例如：有效期设定，判定是否有效，有效状态的切换等</li><li>对于key快速查询操作，例如：按指定策略查询key</li></ul><h3 id="3-key基本操作"><a href="#3-key基本操作" class="headerlink" title="3.key基本操作"></a>3.key基本操作</h3><ul><li><p>删除指定key</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">del key<br></code></pre></td></tr></table></figure></li><li><p>获取key是否存在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">exists key<br></code></pre></td></tr></table></figure></li><li><p>获取key的类型</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">type key<br></code></pre></td></tr></table></figure><p><strong>key扩展操作（时效性控制）</strong></p></li><li><p>为指定key设置有效期</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">expire key seconds     #设置秒<br>pexpire key milliseconds #设置毫秒<br>expireat key timestamp   #秒时间戳<br>pexpireat key milliseconds-timestamp  #毫秒时间戳<br></code></pre></td></tr></table></figure></li><li><p>获取key的有效时间</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ttl key<br>pttl key<br></code></pre></td></tr></table></figure><ul><li>ttl命令下，如果返回值为-2则是key不存在；如果返回值是-1，则是key存在且没有设置有效期；如果key设置有效期，则返回当前剩余的有效时常。</li></ul></li><li><p>切换key从时效性到永久性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">persist key  <br></code></pre></td></tr></table></figure><p><strong>key扩展操作（查询模式）</strong></p></li><li><p>查询key</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">keys pattern<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210421210222191.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li></ul><h3 id="4-key其他操作"><a href="#4-key其他操作" class="headerlink" title="4.key其他操作"></a>4.key其他操作</h3><ul><li><p>为key改名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">rename key newkey<br>renamenx key newkey  #如果key不存在，就改名<br></code></pre></td></tr></table></figure></li><li><p>对所有key排序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sort<br></code></pre></td></tr></table></figure></li><li><p>其他key通用操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">help @generic<br></code></pre></td></tr></table></figure></li></ul><h2 id="二、数据库通用操作"><a href="#二、数据库通用操作" class="headerlink" title="二、数据库通用操作"></a>二、数据库通用操作</h2><p><strong>key的重复问题</strong></p><ul><li>key是由程序员定义的</li><li>redis在使用过程中，伴随着操作数据量的增加，会出现大量的数据以及对应的key</li><li>数据不区分种类，类别混杂在一起，极易出现重复或冲突</li></ul><p><strong>解决方案</strong></p><ul><li>redis为每个服务器提供有16个数据库，编号从0-15</li><li>每个数据库之间的数据互相独立</li></ul><p><img src="https://img-blog.csdnimg.cn/20210421210716812.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="1-db基本操作"><a href="#1-db基本操作" class="headerlink" title="1.db基本操作"></a>1.db基本操作</h3><ul><li><p>切换数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select index<br></code></pre></td></tr></table></figure></li><li><p>其他操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">quit<br>ping<br>echo message<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-db相关操作"><a href="#2-db相关操作" class="headerlink" title="2.db相关操作"></a>2.db相关操作</h3><ul><li><p>数据移动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">move key db<br></code></pre></td></tr></table></figure></li><li><p>数据清除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">dbsize   #查看当前库中key的总数量<br>flushdb  #清除当前库中所有的key<br>flushall #清除所有库中的key<br></code></pre></td></tr></table></figure><p>​</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记5 sorted_set数据类型</title>
    <link href="/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-sorted-set%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-sorted-set%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="sorted-set类型"><a href="#sorted-set类型" class="headerlink" title="sorted_set类型"></a>sorted_set类型</h2><ul><li>新的存储需求：数据排序有利于数据的有效显示，需要提供一种可以根据自身特征进行排序的方式</li><li>需要的存储结构：新的存储模型，可以保存可排序的数据</li><li>sorted_set类型：在set的存储结构基础上添加可排序字段</li></ul><p><img src="https://img-blog.csdnimg.cn/20210421164359468.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="sorted-set类型数据的基本操作"><a href="#sorted-set类型数据的基本操作" class="headerlink" title="sorted_set类型数据的基本操作"></a>sorted_set类型数据的基本操作</h2><ul><li><p>添加数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zadd key score1 member1 [score2 member2]<br><br></code></pre></td></tr></table></figure></li><li><p>获取全部数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zrange key start stop [WITHSCORES]<br></code></pre></td></tr></table></figure></li><li><p>删除数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zrem key member [member1 ...]<br></code></pre></td></tr></table></figure></li><li><p>按条件获取数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zrangebyscore key min max [WITHSCORES] [LIMIT]<br>zrevrangebyscore key max min [WITHSCORES] #逆排序<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210421165618285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p>​</p></li></ul><ul><li><p>按条件获取数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zremrangebyrank key start stop   #按索引删除<br>zremrangebyscore key min max<br></code></pre></td></tr></table></figure></li></ul><p><em>注意</em>：</p><ul><li><em>min与max用于限定搜索查询的条件</em></li><li><em>start与stop用于限定查询范围，作用于索引，表示开始和结束索引</em></li><li><em>offset与count用于限定查询范围，作用于查询结果，表示开始位置和数据总量</em></li></ul><p>​    </p><ul><li><p>获取集合数据总量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">zcard key<br>zcount key min max<br><br></code></pre></td></tr></table></figure></li><li><p>集合交、并操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zinterstore destination numkeys key [key ...]<br>zunionstore destination numkeys key [key ...]<br></code></pre></td></tr></table></figure></li></ul><h2 id="sorted-set类型数据的扩展操作"><a href="#sorted-set类型数据的扩展操作" class="headerlink" title="sorted_set类型数据的扩展操作"></a>sorted_set类型数据的扩展操作</h2><p><strong>业务场景</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421171218699.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><ul><li><p>获取数据对应的索引（排名）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zrank key member<br>zrevrank key member<br></code></pre></td></tr></table></figure></li><li><p>score 值获取与修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zscore key member<br>zincrby key increment member<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210421171509850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li><li><p>redis应用于计数器组合排序功能对应的排名</p></li></ul><h2 id="sorted-set类型数据操作的注意事项"><a href="#sorted-set类型数据操作的注意事项" class="headerlink" title="sorted_set类型数据操作的注意事项"></a>sorted_set类型数据操作的注意事项</h2><ul><li>score保存的数据存储空间是64位，如果是整数范围是-9007199254740992~9007199254740992</li><li>score保存的数据也可以是一个双精度的double值，基于双精度浮点数的特征，可能会丢失精度，使用时侯要慎重</li><li>sorted_set底层存储还是基于set结构的，因此数据不能重复，如果重复添加相同的数据，score值将被反复覆盖，保留最后一次修改的结果</li></ul><p><strong>业务场景</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421171846808.png" alt="img"></p><p> <strong>解决方案</strong></p><ul><li><p>对于基于时间线限定的任务处理，将处理时间记录位score值，利用排序功能区分处理的先后顺序</p></li><li><p>记录下一个要处理的事件，当到期后处理对应的任务，移除redis中的记录，并记录下一个要处理的时间</p></li><li><p>当新任务加入时，判定并更新当前下一个要处理的任务时间</p></li><li><p>为提升sorted_set的性能，通常将任务根据特征存储成若干个sorted_set.例如1小时内，1天内，年度等，操作时逐渐提升，将即将操作的若干个任务纳入到1小时内处理队列中</p></li><li><p>获取当前系统时间</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">time<br></code></pre></td></tr></table></figure><ul><li>redis应用于定时任务顺序管理或任务过期管理</li></ul></li></ul><p><strong>业务场景（任务/消息权重设定应用）</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421172226972.png" alt="img"></p><p><strong>解决方案</strong></p><p><img src="https://img-blog.csdnimg.cn/2021042117234594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><ul><li><p>带有权重的任务，优先处理权重高的任务，采用score记录权重即可</p><p><img src="https://img-blog.csdnimg.cn/20210421172537332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p>​</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记4 Set数据类型</title>
    <link href="/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-Set%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-Set%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="set类型"><a href="#set类型" class="headerlink" title="set类型"></a>set类型</h2><ul><li><p>新的存储需求：存储大量的数据，在查询方面提供更高的效率</p></li><li><p>需要的存储结构：能够保存大量数据，高效的内部存储机制，便于查询</p></li><li><p>set类型：与hash存储结构完全相同，仅存储键，不存储值（nil），并且值是不允许重复的。</p><p><img src="https://img-blog.csdnimg.cn/20210421154631120.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/2021042115482653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li></ul><h2 id="set类型数据的基本操作"><a href="#set类型数据的基本操作" class="headerlink" title="set类型数据的基本操作"></a>set类型数据的基本操作</h2><ul><li><p>添加书籍</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sadd key member1 [member2]<br></code></pre></td></tr></table></figure></li><li><p>获取全部数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">smembers key<br></code></pre></td></tr></table></figure></li><li><p>删除数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">srem key member1 [member2]<br></code></pre></td></tr></table></figure></li><li><p>获取集合数据总量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scard key<br></code></pre></td></tr></table></figure></li><li><p> 判断集合中是否包含指定数据</p></li></ul>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sismember key member<br></code></pre></td></tr></table></figure><h2 id="set类型数据的扩展操作1"><a href="#set类型数据的扩展操作1" class="headerlink" title="set类型数据的扩展操作1"></a>set类型数据的扩展操作1</h2><p><strong>业务操作</strong></p><p>每位用户首次使用进入头条时候会设置3项爱好的内容，但是后期为了增加用户的活跃度，兴趣点，必须让用户对其他信息类别逐渐产生兴趣，增加客户留存度，如何实现？</p><p><strong>业务分析</strong></p><ul><li>系统分析出各个分类的最新或最热点信息条目并组织成set集合</li><li>随机挑选其中部分信息</li><li>配合用户关注信息分类中的热点信息组织展示的全信息集合</li></ul><p><strong>解决方案</strong></p><ul><li><p>随机获取集合中指定数量的数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">srandmember key [count]<br></code></pre></td></tr></table></figure></li><li><p>随机获取集合中的某个数据并将该数据移除集合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">spop key<br></code></pre></td></tr></table></figure></li><li><p>redis应用于随机推荐类信息检索，例如热点歌单推荐，热点新闻推荐，热点旅游线路，应用APP推荐，大V推荐等</p></li></ul><h2 id="set类型数据的扩展操作2"><a href="#set类型数据的扩展操作2" class="headerlink" title="set类型数据的扩展操作2"></a>set类型数据的扩展操作2</h2><ul><li><p>求两个集合的交、并、差集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sinter key [key2]<br></code></pre></td></tr></table></figure></li><li><p>求两个集合的交、并、差集并存储到指定集合中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sinterstore destination key1 [key2]<br>sunionstore destination key1 [key2]<br>sdiffstore destination key1 [key2]<br><br></code></pre></td></tr></table></figure></li><li><p>将指定数据从原始集合中移动到目标集合中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">smove source destination member<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210421162116514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li><li><p>redis应用于同类信息的关联搜索，二度关联搜索，深度关联搜索</p></li><li><p>显示共同关注（一度）</p></li><li><p>显示共同好友（一度）</p></li><li><p>由用户A出发，获取到好友用户B的好友信息列表（一度）</p></li><li><p>由用户A出发，获取到好友用户B的购物清单列表（二度）</p></li><li><p>由用户A出发，获取到好友用户B的游戏充值列表（二度）</p></li></ul><h2 id="set类型数据操作的注意事项"><a href="#set类型数据操作的注意事项" class="headerlink" title="set类型数据操作的注意事项"></a>set类型数据操作的注意事项</h2><ul><li>set类型不允许数据重复，如果添加的数据在set中已经存在，将只保留一份</li><li>set虽然与hash的存储结构相同，但是无法启动hash中存储值的空间</li></ul><p><strong>业务场景</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421162650651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><ul><li>依赖set集合数据不重复的特征，依赖set集合hash存储结构特征完成数据过滤与快速查询</li><li>根据用户id获取用户所有角色</li><li>根据用户所有角色获取用户所有操作权限放入set集合</li><li>根据用户所有觉得获取用户所有数据全选放入set集合</li></ul><p><strong>校验工作</strong>：</p><p>​    redis提供基础数据还是提供校验结果</p><ul><li>redis应用于同类型不重复数据的合并操作</li></ul><h2 id="set类型应用场景"><a href="#set类型应用场景" class="headerlink" title="set类型应用场景"></a>set类型应用场景</h2><p><strong>业务场景</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421163055810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><ul><li>利用set集合的数据去重特征，记录各种访问数据</li><li>建立string类型数据，利用incr统计日访问量（PV)</li><li>建立set模型，记录不同cookie数量（UV)</li><li>建立set模型，记录不用IP数量（IP)</li></ul><p><strong>业务场景（黑白名单）</strong></p><p><img src="https://img-blog.csdnimg.cn/20210421163311178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><ul><li><p>基于经营战略设定问题用户发现、鉴别规则</p></li><li><p>周期性更行满足规则的用户黑名单，加入set集合</p></li><li><p>用户行为信息达到后与黑名单进行比比对，确认行为去向</p></li><li><p>黑名单过滤IP地址：应用于开放游客访问权限的信息源</p></li><li><p>黑名单过滤设备信息：应用于限定访问设备的信息源</p></li><li><p>黑名单过滤用户：应用于基于访问权限的信息源</p></li><li><p>redis应用于基于黑名单与白名单设定的服务控制</p><p>​</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记3 List数据类型</title>
    <link href="/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-List%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-List%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="list类型"><a href="#list类型" class="headerlink" title="list类型"></a>list类型</h2><ul><li><p>数据存储需求：存储多个数据，并对数据进入存储空间的顺序进行区分</p></li><li><p>需要的存储结构：一个存储空间保存多个数据，且通过数据可以体现进入顺序</p></li><li><p>list类型：保存多个数据，底层使用双向链表存储结构实现</p><p><img src="https://img-blog.csdnimg.cn/20210421145318123.png" alt="img"></p></li></ul><h2 id="list类型数据基本操作"><a href="#list类型数据基本操作" class="headerlink" title="list类型数据基本操作"></a>list类型数据基本操作</h2><ul><li><p>添加/修改数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">lpush key value [value2]...   #在key对应的list头部添加元素<br>rpush key value [value2]...   #在key对应的list尾部添加元素<br></code></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">lrange key start stop    <br>lindex key index<br>llen key<br><br></code></pre></td></tr></table></figure></li><li><p>获取并移除数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">lpop key                      #在key对应的list头部删除元素<br>rpop key                      #在key对应的list尾部删除元素<br></code></pre></td></tr></table></figure></li><li><p>规定时间内获取并移除数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">blpop key1 [key2] timeout<br>brpop key1 [key2] timeout<br></code></pre></td></tr></table></figure><p>阻塞式获取，获取值如果还没有的时候等待，如果有值就获取。</p></li></ul><h2 id="list类型数据扩展操作"><a href="#list类型数据扩展操作" class="headerlink" title="list类型数据扩展操作"></a>list类型数据扩展操作</h2><p><strong>业务场景</strong></p><p>微信朋友圈点赞，要求按照点赞顺序显示点赞好友信息，如果取消点赞，移除对应好友信息</p><p><img src="https://img-blog.csdnimg.cn/20210421151850933.png" alt="img"></p><p><strong>解决方案</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">lrem key count value<br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210421152228925.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><ul><li>redis 应用于具有操作先后顺序的数据控制</li></ul><h2 id="list类型数据操作注意事项"><a href="#list类型数据操作注意事项" class="headerlink" title="list类型数据操作注意事项"></a>list类型数据操作注意事项</h2><ul><li>list保存的数据都是string类型，数据总容量有限，最多2[^32]-1个元素。</li><li>list具有索引概念，但是操作数据时通常以队列的形式进行入队出队操作，或以栈的形式入栈出栈操作</li><li>获取全部数据操作结束索引设置为-1</li><li>list可以对数据进行分页操作，通常第一页的信息来自于list，第二页及更多的信息通过数据库的形式加载</li></ul><h2 id="list类型应用场景"><a href="#list类型应用场景" class="headerlink" title="list类型应用场景"></a>list类型应用场景</h2><p><strong>业务场景</strong></p><ol><li>twitter、新浪微博、腾讯微博中个人用于的关注列表需要按照用户的关注顺序进行展示，粉丝列表需要将最近关注的粉丝列在前面</li><li>新闻、资讯类网站如何将最新的新闻或资讯按照发生的事件顺序展示</li><li>企业运营过程中，系统将产生出大量的运营数据，如何保障堕胎服务器操作日志的统一顺序输出？</li></ol><p><strong>解决方案</strong></p><ul><li>依赖list的数据具有顺序的特征对信息进行管理</li><li>使用队列模型解决多路信息汇总合并的问题</li><li>使用栈模型解决最新消息的问题</li></ul>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记2 Hash数据类型</title>
    <link href="/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-Hash%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/04/21/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-Hash%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="一、hash类型"><a href="#一、hash类型" class="headerlink" title="一、hash类型"></a>一、hash类型</h2><ul><li><p>新的存储需求：对一系列存储的数据进行编组，方便管理，典型应用存储对象信息。</p></li><li><p>需要的存储结构：一个存储空间保存多个键值对数据</p></li><li><p>hash类型：底层使用哈希表结构实现数据存储。</p><p><img src="https://img-blog.csdnimg.cn/20210413221436565.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p></li></ul><p><strong>hash存储结构优化</strong></p><ul><li>如果field数量较少，存储结构优化为类数组结构</li><li>如果field数量较多，存储结构使用HashMap结构</li></ul><h2 id="二、hash类型数据的基本操作"><a href="#二、hash类型数据的基本操作" class="headerlink" title="二、hash类型数据的基本操作"></a>二、hash类型数据的基本操作</h2><ul><li>添加/修改数据<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hset key field value<br></code></pre></td></tr></table></figure></li><li>获取数据<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hget key field<br>hgetall key<br></code></pre></td></tr></table></figure></li><li>删除数据<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hdel key field1 [field2]<br></code></pre></td></tr></table></figure></li><li>获取哈希表中是否存在指定的字段<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexists key field<br></code></pre></td></tr></table></figure></li></ul><h2 id="三、hash类型数据拓展操作"><a href="#三、hash类型数据拓展操作" class="headerlink" title="三、hash类型数据拓展操作"></a>三、hash类型数据拓展操作</h2><ul><li>获取哈希表中所有的字段名或字段值<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hkeys key<br></code></pre></td></tr></table></figure></li><li>设定指定字段的数值数据增加指定范围的值<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hincrby key field increment<br>hincrbyfloat key field increment<br></code></pre></td></tr></table></figure></li></ul><h2 id="四、hash类型数据操作的注意事项"><a href="#四、hash类型数据操作的注意事项" class="headerlink" title="四、hash类型数据操作的注意事项"></a>四、hash类型数据操作的注意事项</h2><ul><li>hash类型下的value只能存储字符串，不允许存储其他数据类型，不存在嵌套现象。如果数据未获取到，对应的值为（nil）</li><li>每个hash可以存储2的32次方-1个键值对</li><li>hash类型十分贴近对象的数据存储形式，并且可以灵活添加删除对象属性。但hash设计初衷不是为了存储大量对象而设计的，不可滥用，不能将hash作为对象列表使用</li><li>hgetall操作可以获取全部属性，如果内部field过多，遍历整体数据效率就会很低，有可能成为数据访问瓶颈。</li></ul><h2 id="五、hash类型的应用场景"><a href="#五、hash类型的应用场景" class="headerlink" title="五、hash类型的应用场景"></a>五、hash类型的应用场景</h2><p><strong>业务场景1</strong></p><p>电商网站购物车的实现</p><p><img src="https://img-blog.csdnimg.cn/20210414104649492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>业务分析</strong></p><ul><li>仅分析购物车的redis存储模型（添加、浏览、更改数量、删除、清空</li><li>购物车与数据库间持久化同步</li><li>购物车与订单间关系（提交购物车：读取数据生成订单 商家临时价格调整：隶属于订单级别）</li><li>未登录用户购物车信息存储（cookie存储）</li></ul><p><strong>解决方案</strong></p><p><img src="https://img-blog.csdnimg.cn/20210414110019950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/20210414110917809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>当前设计是否加速了购物车的呈现</strong><br>当前仅仅是将数据存储到reids中，并没有起到加速的作用，商品还需要二次查询数据库</p><ul><li>每条购物车中的商品记录保存成两条field</li><li>field1专用于保存购买数量<br> 命名格式：商品id：nums<pre><code> 保存数据：数值</code></pre></li><li>field2专用于保存购物车中的显示信息，包含文字描述，图片地址，所属商家信息等<br>命名格式：商品id：info<br>保存数据：json</li></ul><p><strong>我们可以把field2作为独立hash，来减少数据的重复</strong><br><font color=#999AAA>创建数据，如果已存在数据则创建失败，如果没有则创建成功</font></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hsetnx key field value<br></code></pre></td></tr></table></figure><p><strong>业务场景2</strong></p><p>抢购活动</p><p><img src="https://img-blog.csdnimg.cn/20210414111343238.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><strong>解决方案</strong></p><p><img src="https://img-blog.csdnimg.cn/20210414111420146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p><font color=#999AAA>创建id为00001的商铺，货物1 25个，货物2 100个。</font></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hmset shopping:id:00001 good1 25 good2 100<br></code></pre></td></tr></table></figure><p><font color=#999AAA>店铺货物1被抢走了10个</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hincrby shopping:id:00001 good1 -10<br></code></pre></td></tr></table></figure><hr><p>学习链接:<a href="https://www.bilibili.com/video/BV1CJ411m7Gc">https://www.bilibili.com/video/BV1CJ411m7Gc</a></p>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis学习笔记1 String数据类型</title>
    <link href="/2021/04/20/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-String%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <url>/2021/04/20/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-String%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="redis-数据类型"><a href="#redis-数据类型" class="headerlink" title="redis 数据类型"></a>redis 数据类型</h1><ol><li>String</li><li>Hash</li><li>list</li><li>set</li><li>sorted_set</li></ol><h1 id="String数据类型"><a href="#String数据类型" class="headerlink" title="String数据类型"></a>String数据类型</h1><h2 id="1-redis-数据存储格式"><a href="#1-redis-数据存储格式" class="headerlink" title="1.redis 数据存储格式"></a>1.redis 数据存储格式</h2><ul><li><p> redis自身是一个Map，其中所有的数据类型都是采用key：value的形式存储。</p></li><li><p>数据类型指的是存储的数据的类型，也就是value部分的类型，key部分永远都是字符串。</p><table><thead><tr><th>key</th><th>value</th></tr></thead><tbody><tr><td>name</td><td>Ruby</td></tr><tr><td>age</td><td>17</td></tr></tbody></table></li></ul><h2 id="2-string类型"><a href="#2-string类型" class="headerlink" title="2.string类型"></a>2.string类型</h2><ul><li>存储的数据：单个数据，最简单的数据存储类型，也是最常用的数据存储类型</li><li>-存储数据的格式：一个存储空间保存一个数据</li><li>存储内容：通常使用字符串，如果字符串以整数形式展示，可作为数字操作使用。</li></ul><h2 id="3-string类型数据的基本操作"><a href="#3-string类型数据的基本操作" class="headerlink" title="3.string类型数据的基本操作"></a>3.string类型数据的基本操作</h2><ul><li><p>添加/修改数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set key value<br></code></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">get key<br></code></pre></td></tr></table></figure></li><li><p>删除数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">del key<br></code></pre></td></tr></table></figure></li><li><p>添加/修改多个数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mset key1 value1 key2 value2 ...<br></code></pre></td></tr></table></figure></li><li><p>获取多个数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mget key<br></code></pre></td></tr></table></figure></li><li><p>获取数据字符串个数（字符串长度）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">strlen key<br></code></pre></td></tr></table></figure></li><li><p>追加信息到原始信息后部（如果原始信息存在就追加，否则新建）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">append key value<br></code></pre></td></tr></table></figure></li></ul><h2 id="4-string类型数据的拓展操作"><a href="#4-string类型数据的拓展操作" class="headerlink" title="4.string类型数据的拓展操作"></a>4.string类型数据的拓展操作</h2><ul><li><p>设置数据具有指定的生命周期</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">set key seconds value<br>psetex key milliseconds value<br></code></pre></td></tr></table></figure><p><em>设置user时效为5s，超出5秒则无法获取。</em></p><p><img src="https://img-blog.csdnimg.cn/20210413204021597.png" alt="img"></p></li><li><p>redis控制数据的生命周期，通过数据是否失效控制业务，适用于所有具有时效性限定控制的操作</p></li></ul><h2 id="5-string类型数据操作的注意事项"><a href="#5-string类型数据操作的注意事项" class="headerlink" title="5.string类型数据操作的注意事项"></a>5.string类型数据操作的注意事项</h2><pre><code>1. 表示运行结果是否成功 （integer）0 → false 失败 （integer）1 → true 成功</code></pre><ol start="2"><li>表示运行结果值<br>（integer） 3 → 3 3个<br> （integer） 1 →1 1个</li><li>数据未获取<br>（nil）== null</li><li>数据最大存储量<br>512MB</li><li>数据计算最大范围（java中的long的最大值）<br>9223372036854775807</li></ol><h2 id="6-业务场景"><a href="#6-业务场景" class="headerlink" title="6.业务场景"></a>6.业务场景</h2><ul><li>主页高频访问信息显示控制，列如新浪微博大V主页显示粉丝数于微博数量</li></ul><p><strong>解决方案</strong> </p><ul><li>在redis中为大v用户设定用户信息，以用户主键和属性值为key，后台设定定时刷新策略。</li></ul><p><img src="https://img-blog.csdnimg.cn/20210413210057424.png" alt="img"></p><ul><li><p>在redis中以json格式存储大v用户，定时刷新</p><p><img src="https://img-blog.csdnimg.cn/20210413210832666.png" alt="img"></p></li></ul><h2 id="7-key的设置约定"><a href="#7-key的设置约定" class="headerlink" title="7.key的设置约定"></a>7.key的设置约定</h2><ul><li><p>热点数据key命名管理</p><p><img src="https://img-blog.csdnimg.cn/20210413211455137.png" alt="img"></p></li></ul><hr>]]></content>
    
    
    <categories>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一些好用的网站推荐</title>
    <link href="/2021/04/19/%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/"/>
    <url>/2021/04/19/%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/</url>
    
    <content type="html"><![CDATA[<p>一些我平常使用的网站，个人觉得还都挺不错的，就写在上面推荐一下。</p><h2 id="设计类"><a href="#设计类" class="headerlink" title="设计类"></a>设计类</h2><h3 id="1-Canva"><a href="#1-Canva" class="headerlink" title="1.Canva"></a>1.Canva</h3><p>网址：<a href="https://www.canva.cn/">https://www.canva.cn</a></p><p>这是一个在线设计的网站。各种实用模板，包括海报，PPT、微信公众号封面，LOGI等。还有一些不同的图片素材。</p><p><img src="https://img-blog.csdnimg.cn/20210420210755800.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="2-Pexels"><a href="#2-Pexels" class="headerlink" title="2.Pexels"></a>2.Pexels</h3><p>网址：<a href="https://www.pexels.com/zh-cn/">https://www.pexels.com/zh-cn/</a></p><p>具有很丰富的高质量图片网站，不光可以免费下载高清图片，而且还可以下载视频，没有版权。</p><p><img src="https://img-blog.csdnimg.cn/20210420211431755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="3-Pixabay"><a href="#3-Pixabay" class="headerlink" title="3.Pixabay"></a>3.Pixabay</h2><p>网址：<a href="https://pixabay.com/">https://pixabay.com/</a></p><p>拥有很多创意向，高清的图片，可以免费下载。</p><p><img src="https://img-blog.csdnimg.cn/20210420212000239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="4-wallhaven"><a href="#4-wallhaven" class="headerlink" title="4.wallhaven"></a>4.wallhaven</h2><p>网址：<a href="https://wallhaven.cc/">https://wallhaven.cc/</a></p><p>有很多不同种类的图片，分辨率非常高，适合用来当作壁纸或各种背景图。</p><p><img src="https://img-blog.csdnimg.cn/20210420212653446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="5-Iconfont"><a href="#5-Iconfont" class="headerlink" title="5.Iconfont"></a>5.Iconfont</h2><p>网址：<a href="https://www.iconfont.cn/">https://www.iconfont.cn/</a></p><p>这是国内第一个最大功能最全的矢量图标库，由阿里巴巴团队稻造的，拥有大量不同的图标，基本上都可以找到自己想要的。</p><p><img src="https://img-blog.csdnimg.cn/20210420213110352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="6-中国色"><a href="#6-中国色" class="headerlink" title="6.中国色"></a>6.中国色</h3><p>网址：<a href="http://zhongguose.com/">http://zhongguose.com/</a></p><p>带有国风色彩的颜色搭配网站。点击RGB搭配的右侧就可以复制、导入颜色了。</p><p><img src="https://img-blog.csdnimg.cn/20210420222253614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="7-ColorHexa"><a href="#7-ColorHexa" class="headerlink" title="7.ColorHexa"></a>7.ColorHexa</h3><p>网址：<a href="https://www.colorhexa.com/">https://www.colorhexa.com/</a></p><p>这是一个方便，颜色种类众多的色彩搭配网站，只需输入想要搭配的颜色，就可以给出不同种的颜色搭配方案。</p><p><img src="https://img-blog.csdnimg.cn/20210420222635239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="学术导航类"><a href="#学术导航类" class="headerlink" title="学术导航类"></a>学术导航类</h2><h3 id="1-科塔学术导航"><a href="#1-科塔学术导航" class="headerlink" title="1.科塔学术导航"></a>1.科塔学术导航</h3><p>网址：<a href="https://site.sciping.com/">https://site.sciping.com/</a></p><p>一个质量不错的学术导航网站，站内分类包括文献数据，期刊出版，学术工具，科研软件，科研数据，学术搜索等。</p><p>它还提供科研社交，科学传播，科研机构版块，每一个版块也会进行具体网站分类；最后，网站的常用推荐功能也可以让你发现很多高质量的学术网站。</p><p><img src="https://img-blog.csdnimg.cn/20210420214033485.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="2-虫部落"><a href="#2-虫部落" class="headerlink" title="2.虫部落"></a>2.虫部落</h3><p>网址：<a href="https://www.chongbuluo.com/">https://www.chongbuluo.com/</a></p><p>功能齐全、很实用的学术搜索网站。</p><p><img src="https://img-blog.csdnimg.cn/20210420214747828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="课程学习类"><a href="#课程学习类" class="headerlink" title="课程学习类"></a>课程学习类</h2><h3 id="1-MOOC"><a href="#1-MOOC" class="headerlink" title="1.MOOC"></a>1.MOOC</h3><p>网址：<a href="https://www.icourse163.org/">https://www.icourse163.org/</a></p><p>国内联合750所高校共同开发的教学网站。收录了非常多名师教学课程。课程种类也非常齐全。</p><p><img src="https://img-blog.csdnimg.cn/20210420215331708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="2-Visuwords"><a href="#2-Visuwords" class="headerlink" title="2.Visuwords"></a>2.Visuwords</h3><p>网址：<a href="https://visuwords.com/">https://visuwords.com/</a></p><p>这是一个比较有趣的交互式单词学习网站，当你输入一个单词回车后，会给出这个单词的近义词、反义词、从属关系词、因果关系词、属性、实例、分词、动词等等。</p><p>它通过不同的颜色和线条，不同颜色的球体构成一个单词树状图，来代表不同单词之间的关系和类型。</p><p><img src="https://img-blog.csdnimg.cn/20210420220418339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-白描"><a href="#1-白描" class="headerlink" title="1.白描"></a>1.白描</h3><p>网址：<a href="https://web.baimiaoapp.com/">https://web.baimiaoapp.com/</a></p><p>这是一个在线扫描工具，有图片文字提取，电子表格识别，PDF转文字，都是免费使用。</p><p><img src="https://img-blog.csdnimg.cn/20210420221121669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="2-Docsmall"><a href="#2-Docsmall" class="headerlink" title="2.Docsmall"></a>2.Docsmall</h3><p>网址：<a href="https://docsmall.com/">https://docsmall.com/</a></p><p>一个免费在线文件压缩网站，只要上传文件之后，进行处理，在下载就ok了，目前支持图片压缩、GIF压缩、PDF压缩、PDF合并、PDF分割功能。</p><p><img src="https://img-blog.csdnimg.cn/20210420221534842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><h3 id="3-地图生成器"><a href="#3-地图生成器" class="headerlink" title="3.地图生成器"></a>3.地图生成器</h3><p>网址： <a href="http://datav.aliyun.com/tools/atlas/#&lat=30.332329214580188&lng=106.72278672066881&zoom=3.5">点击这里</a></p><p>可以下载国内省份，城市以及县城的svg格式的地图素材，并可以导入到PPT中，可编辑。</p><p><img src="https://img-blog.csdnimg.cn/20210420222012372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NzYxMzEwNQ==,size_16,color_FFFFFF,t_70" alt="img"></p><hr><p>后续遇到比较不错的网址还会继续更新下去…</p>]]></content>
    
    
    <categories>
      
      <category>好用的网站</category>
      
    </categories>
    
    
    <tags>
      
      <tag>实用网站</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
